# もじはんと 仕様書

## ゲーム概要

「もじはんと」は2〜5人で遊ぶひらがな当てバトルゲーム。
お題に沿った言葉をひらがなで設定し、他のプレイヤーに当てられないように守りながら、相手の言葉を当てるゲーム。

## 基本ルール

### ゲームの流れ

1. **ルーム作成/参加** - ホストがルームを作成し、他プレイヤーが参加
2. **お題発表** - ランダムにお題が選出される
3. **言葉入力** - 各プレイヤーがお題に沿った言葉をひらがなで入力（2〜7文字）
4. **バトル開始** - 順番にひらがな1文字を宣言して攻撃
5. **ヒット判定** - 宣言した文字が含まれるプレイヤーは該当文字が公開
6. **脱落判定** - 全文字が公開されたプレイヤーは脱落
7. **勝利判定** - 最後まで残ったプレイヤーが勝利

### 攻撃ルール

- 自分の言葉もヒット対象になる
- 他プレイヤーにヒットしたら連続攻撃（1回まで）
- 自分だけヒットした場合は連続攻撃なし
- 誰にもヒットしなければターン終了

### 特殊ルール

#### 同時脱落の勝利条件
2人残りの状態で、両者とも未公開が1文字ずつ、かつ同じ文字だった場合：
- 宣言したプレイヤー（攻撃者）が勝利

### お題チェンジ

- 言葉入力中、全員が「お題チェンジ」に投票すると新しいお題に変更
- 投票は言葉確定後でも可能
- 変更時は全員の入力がリセットされる
- 回数制限なし

## 文字の正規化

入力された言葉は以下のルールで正規化される：

### 濁点・半濁点の除去
- が→か、ぎ→き、ぐ→く、げ→け、ご→こ
- ざ→さ、じ→し、ず→す、ぜ→せ、ぞ→そ
- だ→た、ぢ→ち、づ→つ、で→て、ど→と
- ば→は、び→ひ、ぶ→ふ、べ→へ、ぼ→ほ
- ぱ→は、ぴ→ひ、ぷ→ふ、ぺ→へ、ぽ→ほ

### 小文字の大文字変換
- ぁ→あ、ぃ→い、ぅ→う、ぇ→え、ぉ→お
- ゃ→や、ゅ→ゆ、ょ→よ
- っ→つ
- ゎ→わ

### 長音の変換
- ー（長音符）は直前の母音に変換

## ゲームフェーズ

| フェーズ | 説明 |
|---------|------|
| `waiting` | ロビー待機中（プレイヤー参加待ち） |
| `word_input` | 言葉入力中 |
| `playing` | ゲーム進行中（攻撃フェーズ） |
| `game_end` | ゲーム終了（結果表示） |

## データ構造

### Player（プレイヤー状態）
```typescript
interface Player {
  id: string;
  name: string;
  wordLength: number;        // 言葉の文字数
  normalizedWord: string;    // 正規化後の言葉
  revealedPositions: boolean[];  // 各位置の公開状態
  revealedCharacters: string[];  // 公開された文字
  isEliminated: boolean;     // 脱落フラグ
  isReady: boolean;          // 入力完了フラグ
  eliminatedAt?: number;     // 脱落順（1から）
}
```

### GameState（ゲーム状態）
```typescript
interface GameState {
  phase: GamePhase;
  settings: GameSettings;
  currentTopic: string;
  players: Player[];
  currentTurnPlayerId: string | null;
  turnOrder: string[];
  usedCharacters: string[];
  attackHistory: AttackResult[];
  lastAttackHadHit: boolean;
  winnerId: string | null;
  currentAttack?: CurrentAttack;
  topicChangeVotes: string[];
}
```

## お題一覧

全88種類のお題がランダムで選出される：

### 物・もの系
- 飲みもの、のりもの、文房具、食べもの、音の出るもの
- 学校にあるもの、いま部屋にあるもの、コンビニにあるもの
- 公園にあるもの、最近買ったもの、家にあるもの
- キッチン用品、電子機器、災害時に必要なもの、常に持っていくもの

### 生き物系
- 動物、架空の生き物、虫、生き物、植物

### 食べ物系
- 野菜、くだもの、お菓子、お弁当のおかず、めん類
- 中華料理、パンといえば、寿司ネタ

### 場所・季節系
- 行きたい場所、最近出かけた場所、この近所にあるもの
- 日本の観光地、海外の観光地、海といえば、山といえば
- 春といえば、夏といえば、秋といえば、冬といえば
- お正月、夏休み、年間行事

### 名前・タイトル系
- 職業、名称、有名人の名前、バンド・グループの名前
- 会社の名前、チェーン店の名前
- 本のタイトル、ゲームのタイトル、マンガのタイトル
- キャラクター

### その他
- スポーツ、楽器、武器の名前、技の名前、あいさつ、宇宙といえば

### 形容詞系
- おいしいもの、なつかしいもの、大好きなもの、嫌いなもの
- あまいもの、にがいもの、あたたかいもの、つめたいもの
- 赤いもの、丸いもの、長いもの、大きいもの、やわらかいもの
- とぶもの、まわるもの、禁止されてるもの

### 自分系
- 好きなタイプ、自分を動物に例えると、自分を一言で表すと
- 自分の一番大切なもの、ドキドキするもの、気になるもの
- 苦手だった人の名前、いま食べたいもの

## 画面構成

### 1. ロビー画面（Lobby.tsx）
- ルーム作成/参加
- プレイヤー一覧表示
- ゲーム開始ボタン（ホストのみ）

### 2. 言葉入力画面（WordInputPhase.tsx）
- お題表示
- ひらがな入力フォーム
- プレイヤー準備状況
- お題チェンジ投票ボタン

### 3. ゲーム進行画面（GamePlayPhase.tsx）
- ひらがなボード（攻撃文字選択）
- プレイヤーの言葉表示（PlayerWordDisplay.tsx）
- 攻撃履歴
- 現在のターン表示

### 4. 結果画面（ResultScreen.tsx）
- 勝者表示
- 全プレイヤーの言葉公開
- もう一度遊ぶボタン

## 開発版との差異

`moji-hunt-dev`には以下のデバッグ機能が追加：

- テストプレイヤー追加ボタン
- 各プレイヤーの言葉を個別に設定
- 各プレイヤーとしてお題チェンジ投票
- 1人でもゲーム開始可能
- DEBUGバッジ表示

## Firebase構造

```
moji-hunt-dev/
└── rooms/
    └── {roomCode}/
        ├── hostId: string
        ├── createdAt: number
        └── gameState: GameState
```

本番環境は `moji-hunt/` 以下に同じ構造で保存。
